<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø±ÙØ¹ HTML + QR Generator</title>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .container { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); padding: 30px; border-radius: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.3); }
        input, textarea, button { width: 100%; padding: 12px; margin: 10px 0; border: none; border-radius: 10px; font-size: 16px; box-sizing: border-box; }
        button { background: #4CAF50; color: white; cursor: pointer; font-weight: bold; transition: all 0.3s; }
        button:hover { background: #45a049; transform: translateY(-2px); }
        button:disabled { background: #666; cursor: not-allowed; }
        #qrCanvas { border: 3px solid white; border-radius: 15px; margin: 20px 0; background: white; }
        .status { padding: 15px; border-radius: 10px; margin: 10px 0; font-weight: bold; }
        .success { background: #4CAF50; }
        .error { background: #f44336; }
        .loading { background: #ff9800; }
        .url-box { background: #2c3e50; padding: 15px; border-radius: 10px; word-break: break-all; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ Ø±ÙØ¹ HTML + Ø¥Ù†Ø´Ø§Ø¡ QR Code</h1>
        
        <input type="text" id="token" placeholder="GitHub Personal Access Token (ghp_...)" />
        <input type="text" id="filename" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù (Ù…Ø«Ø§Ù„: 4010108008769.html)" />
        
        <textarea id="htmlContent" rows="8" placeholder="Ø§Ù„Ù…Ø­ØªÙˆÙ‰ HTML Ù‡Ù†Ø§... Ø£Ùˆ Ø§Ø³Ø­Ø¨ Ù…Ù„Ù HTML"></textarea>
        
        <button onclick="uploadAndGenerate()">ğŸ“¤ Ø±ÙØ¹ ÙˆØ¥Ù†Ø´Ø§Ø¡ QR</button>
        
        <div id="status"></div>
        <canvas id="qrCanvas" width="300" height="300" style="display:none;"></canvas>
        <div id="resultUrl" class="url-box" style="display:none;"></div>
        <button id="downloadBtn" onclick="downloadQR()" style="display:none;">ğŸ’¾ ØªØ­Ù…ÙŠÙ„ QR</button>
        
        <hr style="margin: 30px 0;">
        <h3>ğŸ“‹ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø³Ø±ÙŠØ¹Ø©:</h3>
        <ol>
            <li>Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ <a href="https://github.com/settings/tokens" target="_blank" style="color:#4CAF50;">GitHub Token</a> (repo permissions)</li>
            <li>Ø¶Ø¹ Ø§Ù„Ù€ Token + Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù + HTML</li>
            <li>Ø§Ø¶ØºØ· "Ø±ÙØ¹ ÙˆØ¥Ù†Ø´Ø§Ø¡ QR" â†’ Ø§Ù†ØªÙ‡Ù‰!</li>
        </ol>
    </div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª GitHub
        const REPO_OWNER = 'balady-sa-gove';
        const REPO_NAME = 'balady.sa.gov';
        const BRANCH = 'main';
        
        // Drag & Drop Ù„Ù„Ù…Ù„ÙØ§Øª HTML
        const htmlContent = document.getElementById('htmlContent');
        htmlContent.ondragover = e => e.preventDefault();
        htmlContent.ondrop = e => {
            e.preventDefault();
            const file = e.dataTransfer.files[0];
            if (file.name.endsWith('.html') || file.name.endsWith('.htm')) {
                const reader = new FileReader();
                reader.onload = e => {
                    htmlContent.value = e.target.result;
                    document.getElementById('filename').value = file.name;
                };
                reader.readAsText(file);
            }
        };

        async function uploadAndGenerate() {
            const token = document.getElementById('token').value.trim();
            const filename = document.getElementById('filename').value.trim();
            const content = document.getElementById('htmlContent').value.trim();
            
            if (!token || !filename || !content) {
                showStatus('âŒ Ø£Ø¯Ø®Ù„ Token + Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù + Ù…Ø­ØªÙˆÙ‰ HTML', 'error');
                return;
            }
            
            if (!token.startsWith('ghp_') && !token.startsWith('github_pat_')) {
                showStatus('âŒ Token ØºÙŠØ± ØµØ­ÙŠØ­ (ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ ghp_ Ø£Ùˆ github_pat_)', 'error');
                return;
            }
            
            showStatus('â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹ Ø¥Ù„Ù‰ GitHub...', 'loading');
            const btn = document.querySelector('button');
            btn.disabled = true;
            btn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...';
            
            try {
                // 1. ÙØ­Øµ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯
                const checkUrl = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${filename}`;
                const checkResp = await fetch(checkUrl, {
                    headers: { 'Authorization': `token ${token}`, 'Accept': 'application/vnd.github.v3+json' }
                });
                let sha = null;
                if (checkResp.ok) {
                    const data = await checkResp.json();
                    sha = data.sha;
                    showStatus(`ğŸ” Ø§Ù„Ù…Ù„Ù Ù…ÙˆØ¬ÙˆØ¯ØŒ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...`, 'loading');
                }
                
                // 2. ØªØ­ÙˆÙŠÙ„ HTML Ø¥Ù„Ù‰ base64
                const contentB64 = btoa(unescape(encodeURIComponent(content)));
                
                // 3. Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù
                const uploadUrl = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${filename}`;
                const payload = {
                    message: `Upload ${filename} via Web Uploader`,
                    branch: BRANCH,
                    content: contentB64
                };
                if (sha) payload.sha = sha;
                
                const uploadResp = await fetch(uploadUrl, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });
                
                if (!uploadResp.ok) {
                    const error = await uploadResp.json();
                    throw new Error(error.message || `HTTP ${uploadResp.status}`);
                }
                
                // 4. Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· GitHub Pages
                const pageUrl = `https://${REPO_OWNER}.github.io/${REPO_NAME}/${filename}`;
                
                // 5. Ø¥Ù†Ø´Ø§Ø¡ QR
                await QRCode.toCanvas(document.getElementById('qrCanvas'), pageUrl, {
                    width: 300,
                    margin: 2,
                    color: { dark: '#000000', light: '#FFFFFF' }
                });
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
                document.getElementById('resultUrl').textContent = pageUrl;
                document.getElementById('resultUrl').style.display = 'block';
                document.getElementById('qrCanvas').style.display = 'block';
                document.getElementById('downloadBtn').style.display = 'block';
                
                showStatus(`âœ… ØªÙ… Ø§Ù„Ø±ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­!\nØ±Ø§Ø¨Ø·: ${pageUrl}`, 'success');
                navigator.clipboard.writeText(pageUrl);
                
            } catch (error) {
                showStatus(`âŒ Ø®Ø·Ø£: ${error.message}`, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'ğŸ“¤ Ø±ÙØ¹ ÙˆØ¥Ù†Ø´Ø§Ø¡ QR';
            }
        }
        
        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
        }
        
        function downloadQR() {
            const canvas = document.getElementById('qrCanvas');
            const link = document.createElement('a');
            link.download = 'barcode.png';
            link.href = canvas.toDataURL();
            link.click();
        }
        
        // Ù…Ø«Ø§Ù„ HTML Ø¬Ø§Ù‡Ø²
        document.getElementById('htmlContent').value = `<!DOCTYPE html>
<html><head><title>Ø´Ù‡Ø§Ø¯Ø© ØµØ­ÙŠØ©</title></head>
<body style="font-family:Arial;text-align:center;padding:50px;background:#f0f8ff;">
    <h1>âœ… ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚</h1>
    <p>Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© ØµØ­ÙŠØ­Ø© ÙˆÙ…Ø¬Ø¯Ø¯Ø©</p>
    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxjaXJjbGUgY3g9IjUwIiBjeT0iNTAiIHI9IjQ1IiBmaWxsPSIjNERBRjUwIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE0IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+44OQ44O/44O/44OU44KiPC9tZXh0Pgo8L3N2Zz4K" alt="âœ“">
</body></html>`;
    </script>
</body>
</html>
